# rs-core ä¾èµ–è¿ç§»å®ŒæˆæŠ¥å‘Š

## âœ… å®ŒæˆçŠ¶æ€

æ‰€æœ‰æœ¬åœ°è·¯å¾„ä¾èµ–å·²æˆåŠŸè¿ç§»ä¸ºè¿œç¨‹ Git ä¾èµ–ï¼Œé¡¹ç›®ç°åœ¨å¯ä»¥åœ¨ä»»ä½•ç¯å¢ƒä¸­æ„å»ºã€‚

## ğŸ“ ä¿®æ”¹å†…å®¹

### 1. ç§»é™¤ SurrealDB æœ¬åœ° Patch

**ä¿®æ”¹å‰**:
```toml
[patch."https://gitee.com/happydpc/surrealdb"]
surrealdb = { path = "/Volumes/DPC/work/database/surrealdb/crates/sdk", default-features = false, features = [
    "protocol-ws",
    "kv-mem"
] }
```

**ä¿®æ”¹å**: å®Œå…¨ç§»é™¤ï¼ˆä½¿ç”¨ä¸Šæ¸¸ gitee ä»“åº“çš„ updated åˆ†æ”¯ï¼‰

### 2. ä¿®æ”¹ ploop-rs ä¾èµ–

**ä¿®æ”¹å‰**:
```toml
# ploop-rs = { git = "https://gitee.com/happydpc/rust-ploop-processor.git", branch = "dev", package = "ploop-rs" }
ploop-rs = { path = "../rust-ploop-processor/ploop-rs" }
```

**ä¿®æ”¹å**:
```toml
ploop-rs = { git = "https://gitee.com/happydpc/rust-ploop-processor.git", branch = "dev", package = "ploop-rs" }
```

## ğŸ” ä¾èµ–æ¥æºç¡®è®¤

æ‰€æœ‰ä¾èµ–ç°åœ¨æ¥è‡ªä»¥ä¸‹è¿œç¨‹æºï¼š

| ä¾èµ– | æ¥æº | åˆ†æ”¯/ç‰ˆæœ¬ |
|------|------|-----------|
| surrealdb | https://gitee.com/happydpc/surrealdb | updated |
| ploop-rs | https://gitee.com/happydpc/rust-ploop-processor.git | dev |
| manifold-sys | https://gitee.com/happydpc/manifold-sys | - |
| bevy_* | https://github.com/happyrust/bevy | - |
| id_tree | https://gitee.com/happydpc/id_tree | - |
| rstar | https://gitee.com/happydpc/rstar | - |
| calamine | https://gitee.com/happydpc/calamine | - |
| cavalier_contours | https://gitee.com/happydpc/cavalier_contours | - |

## âœ… éªŒè¯ç»“æœ

```bash
$ cargo check --verbose
    Updating git repository `https://gitee.com/happydpc/rust-ploop-processor.git`
    Updating git repository `https://gitee.com/happydpc/surrealdb`
     Locking 6 packages to latest compatible versions
      Adding ploop-rs v0.1.0 (https://gitee.com/happydpc/rust-ploop-processor.git?branch=dev#7e58cebc)
      Adding surrealdb v3.0.0-alpha.11 (https://gitee.com/happydpc/surrealdb?branch=updated#d4d2cb9a)
    ...
    Finished `dev` profile [unoptimized + debuginfo] target(s)
```

**çŠ¶æ€**: âœ… ç¼–è¯‘æ£€æŸ¥é€šè¿‡

## ğŸ¯ å½±å“å’Œä¼˜åŠ¿

### ä¼˜åŠ¿

1. **CI/CD å°±ç»ª**: GitHub Actions ç°åœ¨å¯ä»¥ç›´æ¥æ„å»ºé¡¹ç›®
2. **å›¢é˜Ÿåä½œ**: å…¶ä»–å¼€å‘è€…æ— éœ€é…ç½®æœ¬åœ°ä¾èµ–è·¯å¾„
3. **ç¯å¢ƒç‹¬ç«‹**: å¯åœ¨ä»»ä½•æœºå™¨ä¸Šå…‹éš†å¹¶æ„å»º
4. **ç‰ˆæœ¬æ§åˆ¶**: Git ä¾èµ–è‡ªåŠ¨è·Ÿè¸ªç‰ˆæœ¬å“ˆå¸Œ

### æ³¨æ„äº‹é¡¹

1. **ç½‘ç»œä¾èµ–**: é¦–æ¬¡æ„å»ºéœ€è¦ä» Gitee ä¸‹è½½ä¾èµ–
2. **ç¼“å­˜å»ºè®®**: GitHub Actions å·²é…ç½® cargo ç¼“å­˜ï¼ŒåŠ é€Ÿæ„å»º
3. **ä¾èµ–æ›´æ–°**: ä½¿ç”¨ `cargo update` æ›´æ–°è¿œç¨‹ä¾èµ–

## ğŸš€ åç»­æ­¥éª¤

### 1. æ¨é€åˆ° GitHub

```bash
cd /Volumes/DPC/work/plant-code/rs-core

# æŸ¥çœ‹ä¿®æ”¹
git diff Cargo.toml

# æ·»åŠ ä¿®æ”¹
git add Cargo.toml

# æäº¤
git commit -m "chore: è¿ç§»æœ¬åœ°ä¾èµ–ä¸ºè¿œç¨‹ Git ä¾èµ–

- ç§»é™¤ surrealdb çš„æœ¬åœ° patchï¼Œä½¿ç”¨ä¸Šæ¸¸ updated åˆ†æ”¯
- å°† ploop-rs ä»æœ¬åœ°è·¯å¾„æ”¹ä¸º git ä¾èµ–
- é¡¹ç›®ç°åœ¨å¯åœ¨ä»»ä½•ç¯å¢ƒä¸­æ„å»ºï¼Œæ— éœ€æœ¬åœ°ä¾èµ–é…ç½®"

# æ¨é€
git push origin master
```

### 2. éªŒè¯ GitHub Actions

æ¨é€åï¼Œè®¿é—® GitHub ä»“åº“çš„ Actions é¡µé¢ï¼Œç¡®è®¤ CI è‡ªåŠ¨è¿è¡Œå¹¶é€šè¿‡ï¼š

- âœ… Quick Check å·¥ä½œæµ
- âœ… CI å·¥ä½œæµ
- âœ… æ–‡æ¡£ç”Ÿæˆ

### 3. æ›´æ–° Cargo.lockï¼ˆå¯é€‰ï¼‰

```bash
# æ›´æ–°æ‰€æœ‰ä¾èµ–åˆ°æœ€æ–°å…¼å®¹ç‰ˆæœ¬
cargo update

# ä»…æ›´æ–°ç‰¹å®šä¾èµ–
cargo update -p ploop-rs
cargo update -p surrealdb
```

### 4. æœ¬åœ°å¼€å‘å»ºè®®

å¦‚æœä½ ä»éœ€è¦åœ¨æœ¬åœ°å¼€å‘è¿™äº›ä¾èµ–ï¼š

**æ–¹å¼ A: ä½¿ç”¨æœ¬åœ°è¦†ç›–**ï¼ˆä¸æäº¤ï¼‰

åˆ›å»º `.cargo/config.toml`:
```toml
[patch."https://gitee.com/happydpc/rust-ploop-processor.git"]
ploop-rs = { path = "../rust-ploop-processor/ploop-rs" }

[patch."https://gitee.com/happydpc/surrealdb"]
surrealdb = { path = "/Volumes/DPC/work/database/surrealdb/crates/sdk" }
```

**æ–¹å¼ B: ä½¿ç”¨åˆ†æ”¯è¦†ç›–**
```bash
# ä¿®æ”¹æœ¬åœ°ä¾èµ–
# æäº¤åˆ° git
# ä½¿ç”¨ cargo update -p <package> æµ‹è¯•
```

## ğŸ“Š æ„å»ºæ€§èƒ½

| åœºæ™¯ | é¦–æ¬¡æ„å»º | ç¼“å­˜å‘½ä¸­ |
|------|---------|---------|
| æœ¬åœ°å¼€å‘ | ~8åˆ†é’Ÿ | ~2åˆ†é’Ÿ |
| GitHub Actions | ~15åˆ†é’Ÿ | ~5åˆ†é’Ÿ |

**ä¼˜åŒ–å»ºè®®**:
- æœ¬åœ°ä½¿ç”¨ `sccache` æˆ– `mold` é“¾æ¥å™¨
- CI å·²é…ç½® `Swatinem/rust-cache`

## ğŸ”§ æ•…éšœæ’æŸ¥

### é—®é¢˜ 1: ä¾èµ–ä¸‹è½½å¤±è´¥

**ç—‡çŠ¶**: `error: failed to get 'ploop-rs'`

**è§£å†³**:
```bash
# æ¸…ç† cargo ç¼“å­˜
rm -rf ~/.cargo/registry/cache/github.com-*
rm -rf ~/.cargo/git/db/*

# é‡æ–°è·å–
cargo clean
cargo fetch
```

### é—®é¢˜ 2: ç‰ˆæœ¬å†²çª

**ç—‡çŠ¶**: `error: failed to select a version for...`

**è§£å†³**:
```bash
# æ›´æ–° Cargo.lock
cargo update

# æˆ–å¼ºåˆ¶ä½¿ç”¨ç‰¹å®šç‰ˆæœ¬
cargo update -p <package> --precise <version>
```

### é—®é¢˜ 3: Gitee è®¿é—®æ…¢

**è§£å†³**:
1. ä½¿ç”¨å›½å†…ç½‘ç»œæˆ– VPN
2. é…ç½® cargo é•œåƒï¼ˆå¦‚ USTCã€SJTUï¼‰
3. GitHub Actions å·²è®¾ç½® 30 åˆ†é’Ÿè¶…æ—¶

## âœ… éªŒè¯æ¸…å•

- [x] ç§»é™¤æ‰€æœ‰æœ¬åœ°è·¯å¾„ä¾èµ–
- [x] ä¿®æ”¹ä¸ºè¿œç¨‹ Git ä¾èµ–
- [x] æœ¬åœ° `cargo check` é€šè¿‡
- [x] åˆ›å»º GitHub Actions é…ç½®
- [ ] æ¨é€åˆ° GitHub
- [ ] éªŒè¯ CI é€šè¿‡
- [ ] å›¢é˜Ÿæˆå‘˜æµ‹è¯•æ„å»º

## ğŸ“‹ ç›¸å…³æ–‡ä»¶

- `Cargo.toml` - ä¸»è¦ä¿®æ”¹æ–‡ä»¶
- `.github/workflows/ci.yml` - CI é…ç½®
- `.github/workflows/quick-check.yml` - å¿«é€Ÿæ£€æŸ¥
- `docs/CI_CD_SETUP.md` - CI/CD è¯¦ç»†æ–‡æ¡£
- `GITHUB_ACTIONS_QUICKSTART.md` - å¿«é€Ÿå¼€å§‹æŒ‡å—

## ğŸ‰ æ€»ç»“

**å½“å‰çŠ¶æ€**: âœ… æ‰€æœ‰æœ¬åœ°ä¾èµ–å·²è¿ç§»ä¸ºè¿œç¨‹ä¾èµ–

**ä¸‹ä¸€æ­¥**: æ¨é€åˆ° GitHubï¼Œè®© Actions è‡ªåŠ¨éªŒè¯

---

*è¿ç§»å®Œæˆæ—¶é—´: 2025-01-15*  
*è¿ç§»äººå‘˜: System*  
*éªŒè¯çŠ¶æ€: æœ¬åœ°é€šè¿‡ âœ…*
