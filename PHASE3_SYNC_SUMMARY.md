# Phase 3: æ•°æ®åŒæ­¥æœºåˆ¶å®ç°æ€»ç»“

## å®Œæˆçš„å·¥ä½œ

### 1. åŒæ­¥æ¨¡å—æ¶æ„
åˆ›å»ºäº†å®Œæ•´çš„ `sync` æ¨¡å—ï¼ŒåŒ…å«ä»¥ä¸‹æ ¸å¿ƒç»„ä»¶ï¼š

#### sync_strategy.rs - åŒæ­¥ç­–ç•¥
- **åŒæ­¥æ–¹å‘**: SurrealToKuzu, KuzuToSurreal, Bidirectional
- **åŒæ­¥æ¨¡å¼**: Fullï¼ˆå…¨é‡ï¼‰, Incrementalï¼ˆå¢é‡ï¼‰, Realtimeï¼ˆå®æ—¶ï¼‰, OnDemandï¼ˆæŒ‰éœ€ï¼‰
- **å†²çªè§£å†³**: SourceWins, TargetWins, LatestTimestamp, Manual, Merge
- **è¿‡æ»¤å™¨**: æ”¯æŒæŒ‰ç±»å‹ã€refnoèŒƒå›´ã€å±æ€§åã€ä¿®æ”¹æ—¶é—´è¿‡æ»¤

#### sync_task.rs - ä»»åŠ¡ç®¡ç†
- **ä»»åŠ¡çŠ¶æ€**: Pending, Running, Completed, Failed, Cancelled, Paused
- **ä»»åŠ¡ç±»å‹**: SyncPE, SyncBatchPE, SyncAttributes, SyncRelations, SyncSubtree, SyncAll
- **è¿›åº¦è·Ÿè¸ª**: æ”¯æŒè¿›åº¦ç™¾åˆ†æ¯”ã€æˆåŠŸ/å¤±è´¥è®¡æ•°ã€é‡è¯•æœºåˆ¶
- **ç»Ÿè®¡ä¿¡æ¯**: è®°å½•æ€»è®°å½•æ•°ã€æˆåŠŸç‡ã€è€—æ—¶ç­‰

#### sync_manager.rs - åŒæ­¥ç®¡ç†å™¨
- **æ ¸å¿ƒåŠŸèƒ½**:
  - å…¨é‡åŒæ­¥ï¼šæ‰¹é‡åŒæ­¥æ‰€æœ‰PEåŠå…¶å±æ€§å’Œå…³ç³»
  - å¢é‡åŒæ­¥ï¼šåŸºäºæ—¶é—´æˆ³åŒæ­¥å˜æ›´ï¼ˆæ¡†æ¶å·²å®ç°ï¼‰
  - å•ä¸ªPEåŒæ­¥ï¼šæ”¯æŒç²¾ç¡®åŒæ­¥æŒ‡å®šPE
  - å±æ€§è¿‡æ»¤ï¼šæ ¹æ®ç­–ç•¥è¿‡æ»¤éœ€è¦åŒæ­¥çš„å±æ€§

- **æ„å»ºå™¨æ¨¡å¼**: SyncManagerBuilderæä¾›æµå¼APIé…ç½®åŒæ­¥ç®¡ç†å™¨

### 2. é›†æˆå·¥ä½œ

#### æ¨¡å—é›†æˆ
- åœ¨ `src/lib.rs` ä¸­æ·»åŠ äº† `pub mod sync;`
- åˆ›å»ºäº†é€‚é…å™¨å·¥å‚å‡½æ•°ï¼š
  - `rs_surreal::create_surreal_adapter()`
  - `rs_kuzu::create_kuzu_adapter()`

#### æµ‹è¯•é›†æˆ
- åˆ›å»ºäº† `src/test/test_sync.rs` åŒ…å«8ä¸ªå•å…ƒæµ‹è¯•
- æµ‹è¯•è¦†ç›–ï¼šç­–ç•¥åˆ›å»ºã€è¿‡æ»¤å™¨ã€ä»»åŠ¡ç®¡ç†ã€ç»Ÿè®¡ä¿¡æ¯ã€ç®¡ç†å™¨æ„å»ºç­‰

### 3. KuzuæŸ¥è¯¢å®ç°ä¿®å¤
åœ¨Phase 3ä¹‹å‰ï¼Œå®Œæˆäº†æ‰€æœ‰KuzuæŸ¥è¯¢çš„å®é™…å®ç°ï¼š
- PEæŸ¥è¯¢ã€å±æ€§æŸ¥è¯¢ã€å›¾éå†æŸ¥è¯¢
- ä¿®å¤äº†23ä¸ªç¼–è¯‘é”™è¯¯ï¼Œä¸»è¦æ¶‰åŠï¼š
  - Connectionç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼ˆåˆ›å»ºKuzuConnectionGuardï¼‰
  - APIä½¿ç”¨ä¿®æ­£ï¼ˆæ•°å­—ç´¢å¼•æ›¿ä»£å­—ç¬¦ä¸²é”®ï¼‰
  - ç±»å‹åŒ¹é…é—®é¢˜

## å½“å‰çŠ¶æ€

### âœ… å·²å®Œæˆ
- æ ¸å¿ƒåŒæ­¥æ¡†æ¶
- å…¨é‡åŒæ­¥å®ç°
- å¢é‡åŒæ­¥æ¡†æ¶
- ä»»åŠ¡ç®¡ç†å’Œè¿›åº¦è·Ÿè¸ª
- è¿‡æ»¤å’Œå†²çªè§£å†³ç­–ç•¥
- å•å…ƒæµ‹è¯•ï¼ˆ8ä¸ªæµ‹è¯•å…¨éƒ¨é€šè¿‡ï¼‰
- ç¼–è¯‘æ£€æŸ¥ï¼ˆæ— é”™è¯¯ï¼‰

### ğŸ”„ å¾…ä¼˜åŒ–
1. **å¢é‡åŒæ­¥å®ç°**ï¼šéœ€è¦æ•°æ®åº“æ”¯æŒå˜æ›´è¿½è¸ª
2. **å®æ—¶åŒæ­¥**ï¼šéœ€è¦å®ç°æ•°æ®åº“å˜æ›´ç›‘å¬å™¨
3. **æ€§èƒ½ä¼˜åŒ–**ï¼šæ‰¹é‡æ“ä½œã€å¹¶å‘æ§åˆ¶ã€ç¼“å­˜æœºåˆ¶
4. **ç›‘æ§å’ŒæŒ‡æ ‡**ï¼šæ·»åŠ æ›´è¯¦ç»†çš„æ€§èƒ½æŒ‡æ ‡å’Œç›‘æ§

## ä½¿ç”¨ç¤ºä¾‹

```rust
use aios_core::sync::*;
use aios_core::rs_surreal::create_surreal_adapter;
use aios_core::rs_kuzu::create_kuzu_adapter;
use std::sync::Arc;

// åˆ›å»ºé€‚é…å™¨
let source = Arc::new(create_surreal_adapter()?);
let target = Arc::new(create_kuzu_adapter()?);

// åˆ›å»ºåŒæ­¥ç®¡ç†å™¨
let sync_manager = SyncManagerBuilder::new()
    .source(source)
    .target(target)
    .strategy(SyncStrategy::full_sync()
        .with_direction(SyncDirection::SurrealToKuzu))
    .filter(SyncFilter {
        include_types: vec!["PIPE".to_string()],
        ..Default::default()
    })
    .build()?;

// æ‰§è¡ŒåŒæ­¥
let stats = sync_manager.sync().await?;
println!("åŒæ­¥å®Œæˆ: {} æ¡è®°å½•ï¼ŒæˆåŠŸç‡: {:.2}%",
    stats.total_records, stats.success_rate());
```

## ä¸‹ä¸€æ­¥è®¡åˆ’

### Phase 4: æ€§èƒ½ä¼˜åŒ–å’Œç›‘æ§
1. å®ç°å¹¶å‘åŒæ­¥ï¼ˆå¤šçº¿ç¨‹/å¼‚æ­¥ä»»åŠ¡æ± ï¼‰
2. æ·»åŠ ç¼“å­˜å±‚å‡å°‘é‡å¤æŸ¥è¯¢
3. å®ç°æ‰¹é‡æ“ä½œä¼˜åŒ–
4. æ·»åŠ PrometheusæŒ‡æ ‡å¯¼å‡º
5. åˆ›å»ºåŒæ­¥æ€§èƒ½åŸºå‡†æµ‹è¯•

### Phase 5: ç”Ÿäº§å°±ç»ª
1. å®Œå–„é”™è¯¯æ¢å¤æœºåˆ¶
2. å®ç°æ–­ç‚¹ç»­ä¼ 
3. æ·»åŠ æ•°æ®ä¸€è‡´æ€§æ ¡éªŒ
4. åˆ›å»ºåŒæ­¥é…ç½®ç®¡ç†UI
5. ç¼–å†™è¿ç»´æ–‡æ¡£

## å…³é”®æ–‡ä»¶æ¸…å•

### æ–°å¢æ–‡ä»¶
- `src/sync/mod.rs`
- `src/sync/sync_strategy.rs`
- `src/sync/sync_task.rs`
- `src/sync/sync_manager.rs`
- `src/test/test_sync.rs`
- `src/rs_surreal/adapter.rs`
- `src/rs_kuzu/adapter.rs`

### ä¿®æ”¹æ–‡ä»¶
- `src/lib.rs` - æ·»åŠ syncæ¨¡å—
- `src/test/mod.rs` - æ·»åŠ test_syncæ¨¡å—
- `src/rs_surreal/mod.rs` - æ·»åŠ adapteræ¨¡å—å’Œå¯¼å‡º
- `src/rs_kuzu/mod.rs` - æ·»åŠ adapteræ¨¡å—å’Œå¯¼å‡º

## æ€»ç»“

Phase 3æˆåŠŸå®ç°äº†å®Œæ•´çš„æ•°æ®åŒæ­¥æœºåˆ¶æ¡†æ¶ï¼ŒåŒ…æ‹¬ç­–ç•¥ç®¡ç†ã€ä»»åŠ¡è·Ÿè¸ªã€è¿‡æ»¤å™¨ç­‰æ ¸å¿ƒåŠŸèƒ½ã€‚ç³»ç»Ÿç°åœ¨å¯ä»¥åœ¨SurrealDBå’ŒKuzuä¹‹é—´è¿›è¡Œå…¨é‡æ•°æ®åŒæ­¥ï¼Œå¹¶ä¸ºå¢é‡å’Œå®æ—¶åŒæ­¥é¢„ç•™äº†æ‰©å±•æ¥å£ã€‚æ‰€æœ‰ä»£ç é€šè¿‡ç¼–è¯‘æ£€æŸ¥ï¼Œå•å…ƒæµ‹è¯•100%é€šè¿‡ã€‚